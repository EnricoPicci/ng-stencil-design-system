# ⚡ Phase 3: Angular 19 Application
## Todo App with Stencil Integration

**Duration**: 2-3 days  
**Objective**: Build Angular 19 todo application with Stencil component integration  
**Dependencies**: Phase 2 Complete (Stencil components ready)  
**Next Phase**: Phase 4 - Testing & Quality Assurance

---

## 🎯 Phase 3 Objectives

- ✅ Create Angular 19 standalone components architecture
- ✅ Implement signal-based state management with TodoService
- ✅ Integrate Stencil design system components
- ✅ Build complete todo application functionality
- ✅ Implement localStorage persistence
- ✅ Create responsive and accessible UI
- ✅ Configure Angular + Stencil build integration

---

## 🏗️ Angular Application Architecture

Since we used `ng new --standalone` in Phase 1, the basic structure is already created by Angular CLI. We'll use Angular CLI commands to generate additional components and services.

### Application Structure (Generated by Angular CLI + our additions)
```
packages/todo-app/src/
├── app/
│   ├── components/                 # Generated with ng generate
│   │   └── todo-page/
│   │       ├── todo-page.component.ts
│   │       ├── todo-page.component.scss
│   │       └── todo-page.component.spec.ts
│   ├── services/                   # Generated with ng generate  
│   │   ├── todo.service.ts
│   │   ├── todo.service.spec.ts
│   │   └── storage.service.ts
│   ├── models/                     # Generated with ng generate interface
│   │   ├── todo.model.ts
│   │   └── index.ts
│   ├── stencil-generated/          # Generated by Stencil
│   │   ├── components.ts
│   │   └── index.ts
│   ├── app.component.ts            # Already created by ng new
│   ├── app.component.scss          # Already created by ng new  
│   ├── app.component.spec.ts       # Already created by ng new
│   └── app.config.ts               # Already created by ng new (Angular 19)
├── assets/                         # Already created by ng new
├── environments/                   # Already created by ng new
│   ├── environment.ts
│   └── environment.prod.ts
├── main.ts                         # Already created by ng new
├── index.html                      # Already created by ng new
└── styles.scss                     # Already created by ng new
```

### 🔧 Angular CLI Commands for Phase 3

Navigate to Angular app directory: `cd packages/todo-app`

**Step 1: Generate Interfaces (Models)**
```bash
ng generate interface models/todo --type=model
ng generate interface models/todo-events --type=model  
ng generate interface models/todo-stats --type=model
```

**Step 2: Generate Services**
```bash
ng generate service services/todo
ng generate service services/storage
```

**Step 3: Generate Components**
```bash
ng generate component components/todo-page --standalone
```

**Step 4: Configure Stencil Integration**
- Update app.component.ts to import TodoPageComponent
- Update main.ts for Stencil custom elements
- Configure angular.json for Stencil dependencies

---

## 📋 Implementation Steps Using Angular CLI

### Step 1: Generate Data Models

```bash
cd packages/todo-app

# Generate model interfaces using Angular CLI
ng generate interface models/todo --type=model
ng generate interface models/todo-events --type=model  
ng generate interface models/todo-stats --type=model
```

#### Update generated todo.model.ts
**Angular CLI generates the basic interface files. Update them with our specific interfaces:**

#### src/app/models/todo.model.ts
```typescript
export interface Todo {
  id: string;
  text: string;
  completed: boolean;
  createdAt: Date;
  updatedAt: Date;
}

export interface CreateTodoRequest {
  text: string;
}

export interface UpdateTodoRequest {
  id: string;
  text: string;
}

export interface ToggleTodoRequest {
  id: string;
  completed: boolean;
}
```

#### src/app/models/todo-stats.model.ts  
```typescript
export interface TodoStats {
  total: number;
  completed: number;
  remaining: number;
  completionPercentage: number;
}
```

#### src/app/models/todo-events.model.ts
```typescript
// Stencil component event types
export interface StencilTodoUpdateEvent {
  id: string;
  text: string;
}

export interface StencilTodoDeleteEvent {
  id: string;
}

export interface StencilTodoToggleEvent {
  id: string;
  completed: boolean;
}

export interface StencilInputChangeEvent {
  value: string;
  isValid: boolean;
}
```

### Step 2: Generate Services

```bash
# Generate services using Angular CLI (automatically creates .spec.ts files)
ng generate service services/todo
ng generate service services/storage
```

**Angular CLI automatically generates basic service files with proper imports and structure. Update the generated services:**

#### Update src/app/services/todo.service.ts (Generated by Angular CLI)
```typescript
import { Injectable, computed, signal, effect } from '@angular/core';
import { Todo, CreateTodoRequest, UpdateTodoRequest, ToggleTodoRequest, TodoStats } from '../models/todo.model';
import { StorageService } from './storage.service';

@Injectable({ providedIn: 'root' })
export class TodoService {
  private readonly STORAGE_KEY = 'todos';

  // Private signals
  private _todos = signal<Todo[]>([]);
  private _loading = signal<boolean>(false);
  private _error = signal<string | null>(null);

  // Public readonly signals
  readonly todos = this._todos.asReadonly();
  readonly loading = this._loading.asReadonly();
  readonly error = this._error.asReadonly();

  // Computed signals
  readonly todosCount = computed(() => this.todos().length);
  
  readonly completedTodos = computed(() => 
    this.todos().filter(todo => todo.completed)
  );
  
  readonly remainingTodos = computed(() => 
    this.todos().filter(todo => !todo.completed)
  );
  
  readonly completedCount = computed(() => this.completedTodos().length);
  
  readonly remainingCount = computed(() => this.remainingTodos().length);
  
  readonly stats = computed<TodoStats>(() => {
    const total = this.todosCount();
    const completed = this.completedCount();
    const remaining = this.remainingCount();
    
    return {
      total,
      completed,
      remaining,
      completionPercentage: total > 0 ? Math.round((completed / total) * 100) : 0
    };
  });

  readonly hasTodos = computed(() => this.todosCount() > 0);
  readonly hasCompletedTodos = computed(() => this.completedCount() > 0);
  readonly hasRemainingTodos = computed(() => this.remainingCount() > 0);

  constructor(private storageService: StorageService) {
    this.loadTodos();
    
    // Auto-save effect
    effect(() => {
      this.saveTodos();
    });
  }

  /**
   * Add a new todo
   */
  addTodo(request: CreateTodoRequest): void {
    const text = request.text.trim();
    if (!text) {
      this._error.set('Todo text cannot be empty');
      return;
    }

    this._error.set(null);
    
    const newTodo: Todo = {
      id: this.generateId(),
      text,
      completed: false,
      createdAt: new Date(),
      updatedAt: new Date()
    };

    this._todos.update(todos => [...todos, newTodo]);
  }

  /**
   * Update todo text
   */
  updateTodo(request: UpdateTodoRequest): void {
    const text = request.text.trim();
    if (!text) {
      this._error.set('Todo text cannot be empty');
      return;
    }

    this._error.set(null);
    
    this._todos.update(todos =>
      todos.map(todo =>
        todo.id === request.id
          ? { ...todo, text, updatedAt: new Date() }
          : todo
      )
    );
  }

  /**
   * Toggle todo completion status
   */
  toggleTodo(request: ToggleTodoRequest): void {
    this._error.set(null);
    
    this._todos.update(todos =>
      todos.map(todo =>
        todo.id === request.id
          ? { ...todo, completed: request.completed, updatedAt: new Date() }
          : todo
      )
    );
  }

  /**
   * Delete a todo
   */
  deleteTodo(id: string): void {
    this._error.set(null);
    
    this._todos.update(todos => todos.filter(todo => todo.id !== id));
  }

  /**
   * Clear all completed todos
   */
  clearCompleted(): void {
    this._error.set(null);
    
    this._todos.update(todos => todos.filter(todo => !todo.completed));
  }

  /**
   * Clear all todos
   */
  clearAll(): void {
    this._error.set(null);
    this._todos.set([]);
  }

  /**
   * Clear current error
   */
  clearError(): void {
    this._error.set(null);
  }

  /**
   * Load todos from storage
   */
  private loadTodos(): void {
    try {
      this._loading.set(true);
      
      const stored = this.storageService.getItem<Todo[]>(this.STORAGE_KEY);
      if (stored && Array.isArray(stored)) {
        // Convert date strings back to Date objects
        const todos = stored.map(todo => ({
          ...todo,
          createdAt: new Date(todo.createdAt),
          updatedAt: new Date(todo.updatedAt)
        }));
        
        this._todos.set(todos);
      }
    } catch (error) {
      console.error('Failed to load todos from storage:', error);
      this._error.set('Failed to load saved todos');
    } finally {
      this._loading.set(false);
    }
  }

  /**
   * Save todos to storage
   */
  private saveTodos(): void {
    try {
      const todos = this.todos();
      this.storageService.setItem(this.STORAGE_KEY, todos);
    } catch (error) {
      console.error('Failed to save todos to storage:', error);
      this._error.set('Failed to save todos');
    }
  }

  /**
   * Generate unique ID for todos
   */
  private generateId(): string {
    return `todo_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;
  }
}
```

#### Update src/app/services/storage.service.ts (Generated by Angular CLI)
```typescript
import { Injectable } from '@angular/core';

@Injectable({ providedIn: 'root' })
export class StorageService {
  
  /**
   * Check if localStorage is available
   */
  private get isStorageAvailable(): boolean {
    try {
      return typeof Storage !== 'undefined' && window.localStorage !== null;
    } catch {
      return false;
    }
  }

  /**
   * Get item from localStorage
   */
  getItem<T>(key: string): T | null {
    if (!this.isStorageAvailable) {
      return null;
    }

    try {
      const item = localStorage.getItem(key);
      return item ? JSON.parse(item) : null;
    } catch (error) {
      console.error(`Error retrieving item '${key}' from localStorage:`, error);
      return null;
    }
  }

  /**
   * Set item in localStorage
   */
  setItem<T>(key: string, value: T): boolean {
    if (!this.isStorageAvailable) {
      return false;
    }

    try {
      localStorage.setItem(key, JSON.stringify(value));
      return true;
    } catch (error) {
      console.error(`Error storing item '${key}' in localStorage:`, error);
      return false;
    }
  }

  /**
   * Remove item from localStorage
   */
  removeItem(key: string): boolean {
    if (!this.isStorageAvailable) {
      return false;
    }

    try {
      localStorage.removeItem(key);
      return true;
    } catch (error) {
      console.error(`Error removing item '${key}' from localStorage:`, error);
      return false;
    }
  }

  /**
   * Clear all items from localStorage
   */
  clear(): boolean {
    if (!this.isStorageAvailable) {
      return false;
    }

    try {
      localStorage.clear();
      return true;
    } catch (error) {
      console.error('Error clearing localStorage:', error);
      return false;
    }
  }

  /**
   * Get all keys from localStorage
   */
  getAllKeys(): string[] {
    if (!this.isStorageAvailable) {
      return [];
    }

    try {
      return Object.keys(localStorage);
    } catch (error) {
      console.error('Error getting localStorage keys:', error);
      return [];
    }
  }

  /**
   * Check if key exists in localStorage
   */
  hasItem(key: string): boolean {
    if (!this.isStorageAvailable) {
      return false;
    }

    return localStorage.getItem(key) !== null;
  }
}
```

### Step 3: Generate Components

```bash
# Generate standalone component using Angular CLI
ng generate component components/todo-page --standalone
```

**Angular CLI automatically creates the component files with proper structure. Update the generated files:**

---

## 🧩 Angular Components

### 1. Root App Component (Already generated by `ng new`)

#### Update src/app/app.component.ts
```typescript
import { Component } from '@angular/core';

@Component({
  selector: 'app-root',
  standalone: true,
  imports: [],
  template: `
    <div class="app">
      <header class="app-header">
        <h1 class="app-title">Todo Application</h1>
        <p class="app-subtitle">Built with Angular 19 + Stencil Design System</p>
      </header>
      
      <main class="app-main">
        <app-todo-page />
      </main>
      
      <footer class="app-footer">
        <p>© 2025 Todo App - Angular 19 + Stencil Integration Demo</p>
      </footer>
    </div>
  `,
  styleUrls: ['./app.component.scss']
})
export class AppComponent {
  title = 'Todo Application';
}
```

#### app.component.scss
```scss
:host {
  display: block;
  min-height: 100vh;
}

.app {
  display: flex;
  flex-direction: column;
  min-height: 100vh;
  background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);

  &-header {
    text-align: center;
    padding: 2rem 1rem;
    background: rgba(255, 255, 255, 0.1);
    backdrop-filter: blur(10px);
    border-bottom: 1px solid rgba(255, 255, 255, 0.2);
  }

  &-title {
    font-size: 2.5rem;
    font-weight: 700;
    color: #1f2937;
    margin: 0 0 0.5rem 0;
    letter-spacing: -0.025em;
  }

  &-subtitle {
    font-size: 1.125rem;
    color: #6b7280;
    margin: 0;
    font-weight: 400;
  }

  &-main {
    flex: 1;
    display: flex;
    justify-content: center;
    padding: 2rem 1rem;
  }

  &-footer {
    text-align: center;
    padding: 1rem;
    color: #6b7280;
    font-size: 0.875rem;
    background: rgba(255, 255, 255, 0.1);
    backdrop-filter: blur(10px);
    border-top: 1px solid rgba(255, 255, 255, 0.2);
  }
}

@media (max-width: 640px) {
  .app {
    &-header {
      padding: 1.5rem 1rem;
    }

    &-title {
      font-size: 2rem;
    }

    &-subtitle {
      font-size: 1rem;
    }

    &-main {
      padding: 1rem;
    }
  }
}
```

### 2. Todo Page Component (Generated by Angular CLI)

#### Update src/app/components/todo-page/todo-page.component.ts
```typescript
import { Component, CUSTOM_ELEMENTS_SCHEMA, OnInit } from '@angular/core';
import { CommonModule } from '@angular/common';
import { FormsModule } from '@angular/forms';
import { TodoService } from '../../services/todo.service';
import { 
  StencilTodoUpdateEvent, 
  StencilTodoDeleteEvent, 
  StencilTodoToggleEvent,
  StencilInputChangeEvent
} from '../../models/todo.model';

@Component({
  selector: 'app-todo-page',
  standalone: true,
  imports: [CommonModule, FormsModule],
  schemas: [CUSTOM_ELEMENTS_SCHEMA],
  template: `
    <div class="todo-page">
      <div class="todo-container">
        <!-- Input Section -->
        <section class="todo-input-section" aria-label="Add new todo">
          <div class="input-group">
            <ds-input
              [value]="newTodoText"
              placeholder="What needs to be done?"
              [required]="true"
              [errorMessage]="inputError"
              ariaLabel="Enter new todo"
              (dsInput)="onInputChange($event)"
              (dsKeyUp)="onKeyUp($event)"
              class="todo-input">
            </ds-input>
            
            <ds-button
              variant="primary"
              size="lg"
              [disabled]="!canAddTodo()"
              [loading]="todoService.loading()"
              (dsClick)="addTodo()"
              ariaLabel="Add todo">
              Add Todo
            </ds-button>
          </div>
          
          @if (todoService.error()) {
            <div class="error-message" role="alert">
              {{ todoService.error() }}
              <button 
                type="button" 
                class="error-dismiss"
                (click)="todoService.clearError()"
                aria-label="Dismiss error">
                ×
              </button>
            </div>
          }
        </section>

        <!-- Stats Section -->
        @if (todoService.hasTodos()) {
          <section class="todo-stats-section" aria-label="Todo statistics">
            <div class="stats-card">
              <div class="stat">
                <span class="stat-value">{{ todoService.stats().total }}</span>
                <span class="stat-label">Total</span>
              </div>
              <div class="stat">
                <span class="stat-value">{{ todoService.stats().remaining }}</span>
                <span class="stat-label">Remaining</span>
              </div>
              <div class="stat">
                <span class="stat-value">{{ todoService.stats().completed }}</span>
                <span class="stat-label">Completed</span>
              </div>
              <div class="stat">
                <span class="stat-value">{{ todoService.stats().completionPercentage }}%</span>
                <span class="stat-label">Progress</span>
              </div>
            </div>
            
            @if (todoService.hasCompletedTodos()) {
              <div class="stats-actions">
                <ds-button
                  variant="ghost"
                  size="sm"
                  (dsClick)="clearCompleted()"
                  ariaLabel="Clear completed todos">
                  Clear Completed
                </ds-button>
              </div>
            }
          </section>
        }

        <!-- Todo List Section -->
        <section class="todo-list-section" aria-label="Todo list">
          <ds-todo-list
            [todos]="todoService.todos()"
            [emptyMessage]="getEmptyMessage()"
            [showStats]="false"
            (todoUpdate)="updateTodo($event)"
            (todoDelete)="deleteTodo($event)"
            (todoToggle)="toggleTodo($event)">
          </ds-todo-list>
        </section>
      </div>
    </div>
  `,
  styleUrls: ['./todo-page.component.scss']
})
export class TodoPageComponent implements OnInit {
  newTodoText = '';
  inputError = '';

  constructor(public todoService: TodoService) {}

  ngOnInit(): void {
    // Component is ready, Stencil components should be loaded
  }

  /**
   * Handle input change from Stencil ds-input
   */
  onInputChange(event: CustomEvent<string>): void {
    this.newTodoText = event.detail;
    this.validateInput();
  }

  /**
   * Handle key up events from Stencil ds-input
   */
  onKeyUp(event: CustomEvent<KeyboardEvent>): void {
    if (event.detail.key === 'Enter') {
      this.addTodo();
    }
  }

  /**
   * Add a new todo
   */
  addTodo(): void {
    if (!this.canAddTodo()) {
      return;
    }

    this.todoService.addTodo({ text: this.newTodoText });
    this.newTodoText = '';
    this.inputError = '';
  }

  /**
   * Update todo from Stencil ds-todo-item
   */
  updateTodo(event: CustomEvent<StencilTodoUpdateEvent>): void {
    this.todoService.updateTodo({
      id: event.detail.id,
      text: event.detail.text
    });
  }

  /**
   * Delete todo from Stencil ds-todo-item
   */
  deleteTodo(event: CustomEvent<StencilTodoDeleteEvent>): void {
    this.todoService.deleteTodo(event.detail.id);
  }

  /**
   * Toggle todo completion from Stencil ds-todo-item
   */
  toggleTodo(event: CustomEvent<StencilTodoToggleEvent>): void {
    this.todoService.toggleTodo({
      id: event.detail.id,
      completed: event.detail.completed
    });
  }

  /**
   * Clear all completed todos
   */
  clearCompleted(): void {
    this.todoService.clearCompleted();
  }

  /**
   * Check if we can add a new todo
   */
  canAddTodo(): boolean {
    return this.newTodoText.trim().length > 0 && !this.todoService.loading();
  }

  /**
   * Get empty state message
   */
  getEmptyMessage(): string {
    if (this.todoService.loading()) {
      return 'Loading your todos...';
    }
    return 'No todos yet. Add one above to get started!';
  }

  /**
   * Validate input field
   */
  private validateInput(): void {
    if (this.newTodoText.trim().length === 0) {
      this.inputError = '';
    } else if (this.newTodoText.trim().length > 500) {
      this.inputError = 'Todo text cannot exceed 500 characters';
    } else {
      this.inputError = '';
    }
  }
}
```

#### todo-page.component.scss
```scss
.todo-page {
  width: 100%;
  max-width: 600px;
  margin: 0 auto;
}

.todo-container {
  background: white;
  border-radius: 1rem;
  box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 
              0 10px 10px -5px rgba(0, 0, 0, 0.04);
  overflow: hidden;
}

.todo-input-section {
  padding: 2rem;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;

  .input-group {
    display: flex;
    gap: 1rem;
    margin-bottom: 1rem;

    .todo-input {
      flex: 1;
    }

    ds-button {
      flex-shrink: 0;
    }
  }

  .error-message {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 0.75rem 1rem;
    background: rgba(239, 68, 68, 0.1);
    border: 1px solid rgba(239, 68, 68, 0.3);
    border-radius: 0.5rem;
    color: #fef2f2;
    font-size: 0.875rem;

    .error-dismiss {
      background: none;
      border: none;
      color: #fef2f2;
      font-size: 1.25rem;
      cursor: pointer;
      padding: 0;
      margin-left: 1rem;

      &:hover {
        color: #fff;
      }
    }
  }
}

.todo-stats-section {
  padding: 1.5rem 2rem;
  border-bottom: 1px solid #e5e7eb;
  background: #f9fafb;

  .stats-card {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
    gap: 1rem;
    margin-bottom: 1rem;

    .stat {
      text-align: center;

      &-value {
        display: block;
        font-size: 1.5rem;
        font-weight: 700;
        color: #1f2937;
      }

      &-label {
        display: block;
        font-size: 0.75rem;
        font-weight: 500;
        color: #6b7280;
        text-transform: uppercase;
        letter-spacing: 0.05em;
        margin-top: 0.25rem;
      }
    }
  }

  .stats-actions {
    display: flex;
    justify-content: center;
  }
}

.todo-list-section {
  padding: 2rem;
  min-height: 200px;
}

// Mobile optimizations
@media (max-width: 640px) {
  .todo-page {
    margin: 0 1rem;
  }

  .todo-container {
    border-radius: 0.75rem;
  }

  .todo-input-section {
    padding: 1.5rem;

    .input-group {
      flex-direction: column;
      gap: 0.75rem;
    }
  }

  .todo-stats-section {
    padding: 1rem 1.5rem;

    .stats-card {
      grid-template-columns: repeat(2, 1fr);
      gap: 0.75rem;
    }
  }

  .todo-list-section {
    padding: 1.5rem;
  }
}

@media (max-width: 480px) {
  .todo-page {
    margin: 0 0.5rem;
  }

  .todo-input-section {
    padding: 1rem;
  }

  .todo-stats-section {
    padding: 1rem;

    .stats-card {
      grid-template-columns: 1fr 1fr;
    }
  }

  .todo-list-section {
    padding: 1rem;
  }
}
```

---

## 🔗 Stencil Integration Setup

### main.ts (Bootstrap with Stencil)
```typescript
import { bootstrapApplication } from '@angular/platform-browser';
import { importProvidersFrom } from '@angular/core';
import { BrowserAnimationsModule } from '@angular/platform-browser/animations';

// Import Stencil components
import { defineCustomElements } from '@todo-design-system/core/loader';

import { AppComponent } from './app/components/app/app.component';
import { TodoPageComponent } from './app/components/todo-page/todo-page.component';

// Define Stencil custom elements
defineCustomElements();

bootstrapApplication(AppComponent, {
  providers: [
    importProvidersFrom(BrowserAnimationsModule),
    // Add other providers as needed
  ]
}).catch(err => console.error(err));
```

### Update app.component.ts imports
```typescript
import { Component } from '@angular/core';
import { TodoPageComponent } from '../todo-page/todo-page.component';

@Component({
  selector: 'app-root',
  standalone: true,
  imports: [TodoPageComponent], // Add TodoPageComponent import
  // ... rest of component
})
export class AppComponent {
  // ... component implementation
}
```

### styles.scss (Global Application Styles)
```scss
// Import design system styles
@import '@todo-design-system/core/dist/todo-design-system/todo-design-system.css';

// Global application styles
:root {
  --app-font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
}

* {
  box-sizing: border-box;
}

html {
  height: 100%;
  font-size: 16px;
}

body {
  margin: 0;
  padding: 0;
  height: 100%;
  font-family: var(--app-font-family);
  line-height: 1.6;
  color: #333;
  background-color: #f5f7fa;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

// Focus styles for accessibility
*:focus-visible {
  outline: 2px solid #3b82f6;
  outline-offset: 2px;
}

// Screen reader only utility
.sr-only {
  position: absolute;
  width: 1px;
  height: 1px;
  padding: 0;
  margin: -1px;
  overflow: hidden;
  clip: rect(0, 0, 0, 0);
  white-space: nowrap;
  border: 0;
}

// Print styles
@media print {
  * {
    background: transparent !important;
    color: black !important;
    box-shadow: none !important;
    text-shadow: none !important;
  }
}
```

---

## 🧪 Unit Testing Setup

### todo.service.spec.ts
```typescript
import { TestBed } from '@angular/core/testing';
import { TodoService } from './todo.service';
import { StorageService } from './storage.service';

describe('TodoService', () => {
  let service: TodoService;
  let storageService: jasmine.SpyObj<StorageService>;

  beforeEach(() => {
    const storageServiceSpy = jasmine.createSpyObj('StorageService', 
      ['getItem', 'setItem', 'removeItem', 'clear', 'hasItem']
    );

    TestBed.configureTestingModule({
      providers: [
        TodoService,
        { provide: StorageService, useValue: storageServiceSpy }
      ]
    });

    service = TestBed.inject(TodoService);
    storageService = TestBed.inject(StorageService) as jasmine.SpyObj<StorageService>;
    
    // Reset localStorage spy
    storageService.getItem.and.returnValue(null);
    storageService.setItem.and.returnValue(true);
  });

  it('should be created', () => {
    expect(service).toBeTruthy();
  });

  it('should start with empty todos', () => {
    expect(service.todos()).toEqual([]);
    expect(service.todosCount()).toBe(0);
  });

  it('should add a new todo', () => {
    const todoText = 'Test todo';
    
    service.addTodo({ text: todoText });
    
    expect(service.todosCount()).toBe(1);
    expect(service.todos()[0].text).toBe(todoText);
    expect(service.todos()[0].completed).toBe(false);
  });

  it('should not add empty todo', () => {
    service.addTodo({ text: '   ' });
    
    expect(service.todosCount()).toBe(0);
    expect(service.error()).toBe('Todo text cannot be empty');
  });

  it('should update todo text', () => {
    service.addTodo({ text: 'Original text' });
    const todoId = service.todos()[0].id;
    
    service.updateTodo({ id: todoId, text: 'Updated text' });
    
    expect(service.todos()[0].text).toBe('Updated text');
  });

  it('should toggle todo completion', () => {
    service.addTodo({ text: 'Test todo' });
    const todoId = service.todos()[0].id;
    
    service.toggleTodo({ id: todoId, completed: true });
    
    expect(service.todos()[0].completed).toBe(true);
    expect(service.completedCount()).toBe(1);
    expect(service.remainingCount()).toBe(0);
  });

  it('should delete todo', () => {
    service.addTodo({ text: 'Test todo' });
    const todoId = service.todos()[0].id;
    
    service.deleteTodo(todoId);
    
    expect(service.todosCount()).toBe(0);
  });

  it('should calculate stats correctly', () => {
    service.addTodo({ text: 'Todo 1' });
    service.addTodo({ text: 'Todo 2' });
    service.addTodo({ text: 'Todo 3' });
    
    const firstTodoId = service.todos()[0].id;
    service.toggleTodo({ id: firstTodoId, completed: true });
    
    const stats = service.stats();
    expect(stats.total).toBe(3);
    expect(stats.completed).toBe(1);
    expect(stats.remaining).toBe(2);
    expect(stats.completionPercentage).toBe(33);
  });

  it('should clear completed todos', () => {
    service.addTodo({ text: 'Todo 1' });
    service.addTodo({ text: 'Todo 2' });
    
    const firstTodoId = service.todos()[0].id;
    service.toggleTodo({ id: firstTodoId, completed: true });
    
    service.clearCompleted();
    
    expect(service.todosCount()).toBe(1);
    expect(service.todos()[0].text).toBe('Todo 2');
  });

  it('should save todos to storage', () => {
    service.addTodo({ text: 'Test todo' });
    
    expect(storageService.setItem).toHaveBeenCalledWith('todos', jasmine.any(Array));
  });
});
```

### todo-page.component.spec.ts
```typescript
import { ComponentFixture, TestBed } from '@angular/core/testing';
import { CUSTOM_ELEMENTS_SCHEMA } from '@angular/core';
import { TodoPageComponent } from './todo-page.component';
import { TodoService } from '../../services/todo.service';
import { StorageService } from '../../services/storage.service';

describe('TodoPageComponent', () => {
  let component: TodoPageComponent;
  let fixture: ComponentFixture<TodoPageComponent>;
  let todoService: jasmine.SpyObj<TodoService>;

  beforeEach(async () => {
    const todoServiceSpy = jasmine.createSpyObj('TodoService', [
      'addTodo', 'updateTodo', 'deleteTodo', 'toggleTodo', 'clearCompleted', 'clearError'
    ], {
      todos: jasmine.createSpy().and.returnValue([]),
      loading: jasmine.createSpy().and.returnValue(false),
      error: jasmine.createSpy().and.returnValue(null),
      hasTodos: jasmine.createSpy().and.returnValue(false),
      hasCompletedTodos: jasmine.createSpy().and.returnValue(false),
      stats: jasmine.createSpy().and.returnValue({ total: 0, completed: 0, remaining: 0, completionPercentage: 0 })
    });

    await TestBed.configureTestingModule({
      imports: [TodoPageComponent],
      providers: [
        { provide: TodoService, useValue: todoServiceSpy },
        { provide: StorageService, useValue: {} }
      ],
      schemas: [CUSTOM_ELEMENTS_SCHEMA]
    }).compileComponents();

    fixture = TestBed.createComponent(TodoPageComponent);
    component = fixture.componentInstance;
    todoService = TestBed.inject(TodoService) as jasmine.SpyObj<TodoService>;
  });

  it('should create', () => {
    expect(component).toBeTruthy();
  });

  it('should handle input change', () => {
    const inputValue = 'New todo text';
    const event = new CustomEvent('dsInput', { detail: inputValue });
    
    component.onInputChange(event);
    
    expect(component.newTodoText).toBe(inputValue);
  });

  it('should add todo on Enter key press', () => {
    component.newTodoText = 'Test todo';
    const event = new CustomEvent('dsKeyUp', { 
      detail: new KeyboardEvent('keyup', { key: 'Enter' })
    });
    
    component.onKeyUp(event);
    
    expect(todoService.addTodo).toHaveBeenCalledWith({ text: 'Test todo' });
  });

  it('should not add empty todo', () => {
    component.newTodoText = '   ';
    
    component.addTodo();
    
    expect(todoService.addTodo).not.toHaveBeenCalled();
  });

  it('should handle todo update event', () => {
    const updateEvent = { id: '1', text: 'Updated text' };
    const event = new CustomEvent('todoUpdate', { detail: updateEvent });
    
    component.updateTodo(event);
    
    expect(todoService.updateTodo).toHaveBeenCalledWith(updateEvent);
  });

  it('should handle todo delete event', () => {
    const deleteEvent = { id: '1' };
    const event = new CustomEvent('todoDelete', { detail: deleteEvent });
    
    component.deleteTodo(event);
    
    expect(todoService.deleteTodo).toHaveBeenCalledWith('1');
  });

  it('should handle todo toggle event', () => {
    const toggleEvent = { id: '1', completed: true };
    const event = new CustomEvent('todoToggle', { detail: toggleEvent });
    
    component.toggleTodo(event);
    
    expect(todoService.toggleTodo).toHaveBeenCalledWith(toggleEvent);
  });
});
```

---

## ✅ Success Criteria

### Phase 3 Complete When:
- [ ] **Angular App**: TodoPageComponent renders with Stencil components
- [ ] **State Management**: TodoService with signals working correctly
- [ ] **Stencil Integration**: All 4 Stencil components functioning in Angular
- [ ] **Persistence**: localStorage saving/loading todos properly
- [ ] **Event Handling**: All Stencil→Angular events working
- [ ] **Responsive Design**: Mobile and desktop layouts working
- [ ] **Unit Tests**: 90%+ test coverage for services and components
- [ ] **Build Success**: `npm run build -w packages/todo-app` completes

### Validation Commands:
```bash
# Test Angular build
npm run build -w packages/todo-app

# Run Angular tests
npm run test -w packages/todo-app

# Start development server
npm run start -w packages/todo-app

# Test functionality manually
# 1. Add todos via input + button
# 2. Edit todos by clicking on text
# 3. Delete todos via delete button
# 4. Toggle completion via checkbox
# 5. Verify localStorage persistence
```

---

## 📋 Phase 3 Checklist

**Using Angular CLI Commands:**
- [ ] **Generate interfaces**: `ng generate interface models/todo --type=model` (+ events, stats)
- [ ] **Generate services**: `ng generate service services/todo` & `ng generate service services/storage`
- [ ] **Generate components**: `ng generate component components/todo-page --standalone`
- [ ] **Update generated files** with our implementation code
- [ ] **Configure Stencil integration** in main.ts and app.component.ts
- [ ] **Implement todo CRUD operations** in generated TodoService
- [ ] **Add responsive design** to generated component stylesheets
- [ ] **Unit tests** automatically created by Angular CLI - update with our test cases
- [ ] **Test Stencil→Angular event handling** using CUSTOM_ELEMENTS_SCHEMA
- [ ] **Verify localStorage persistence** in StorageService
- [ ] **Test accessibility features** and ARIA compliance
- [ ] **Optimize performance** and validate with `ng build`

**✅ Advantages of Angular CLI Approach:**
- Automatic file structure and imports setup
- Consistent naming conventions  
- Test files (.spec.ts) automatically generated
- Proper TypeScript configuration applied
- Injectable decorators and imports configured
- Component selector and standalone setup handled

---

## 🎯 Next Steps

Once Phase 3 is complete:
1. **Proceed to Phase 4**: Testing & Quality Assurance
2. **Verify Integration**: Full Angular + Stencil application working
3. **Test All Features**: Complete todo functionality validated

**Phase 4 Prerequisites Met:**
✅ Complete Angular todo application functional  
✅ Stencil components integrated successfully  
✅ State management with signals working  
✅ Unit tests passing for all components